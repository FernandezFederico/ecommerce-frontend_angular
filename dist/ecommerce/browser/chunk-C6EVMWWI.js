import{a,b as u}from"./chunk-SXOTAUVO.js";import{a as m}from"./chunk-XHZKNT62.js";import{J as n,ga as l,la as c,m as o,q as h}from"./chunk-W6ACBSJJ.js";var C=(()=>{let e=class e{constructor(t,r){this.http=t,this.alertService=r,this.cart=[],this.cartSubject=new o(this.cart),this.cart$=this.cartSubject.asObservable(),this.formatter=new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}),this.loadCartFromStorage()}loadCartFromStorage(){let t=localStorage.getItem("cartData");t&&this.setCartItems(JSON.parse(t))}setCartItems(t){this.cart=t,this.cartSubject.next(this.cart)}addToCard(t){this.cart.push(t),localStorage.setItem("cartData",JSON.stringify(this.cart)),this.cartSubject.next(this.cart)}removeFromLocalCart(t){let r=this.cart.findIndex(s=>s._id===t._id);r!==-1&&(this.cart.splice(r,1),localStorage.setItem("cartData",JSON.stringify(this.cart)),this.cartSubject.next(this.cart)),this.getCartItemCount()<=0&&this.clearCart()}clearCart(){this.cart=[],localStorage.removeItem("cartData"),this.cartSubject.next(this.cart)}getCart(){return this.cart}resetCart(){this.cart=[],localStorage.removeItem("cartData"),this.cartSubject.next(this.cart)}getCartItemCount(){return this.cart.length}formatPrice(t){return this.formatter.format(t)}createCartDataInDb(t){return this.http.post(`${a.apiUrl}/carts`,t)}getCartListByUserId(t){return this.http.get(`${a.apiUrl}/carts/user/${t}`).pipe(n(r=>(this.alertService.showErrorAlert("Error al cargar los productos"),h([]))))}getCartProductsFromDb(t){this.getCartListByUserId(t).subscribe({next:r=>{this.setCartItems(r.map(s=>s.Product))},error:r=>{this.alertService.showErrorAlert("Error al cargar los datos!")}})}removeProductFromCart(t,r){return this.http.delete(`${a.apiUrl}/carts/user/${t}/product/${r}`)}};e.\u0275fac=function(r){return new(r||e)(c(m),c(u))},e.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();export{C as a};
